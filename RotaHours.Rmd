---
title: "On-call Hours in ICU"
author: "AJ Clarkin"
date: "08/02/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Background

All consultants are asked to record their on-call hours when first-on for ICU. These are used for job planning.


```{r environment}

library(tidyverse)
library(here)
library(lubridate)
```


```{r file-imports}

# note the squiffy null value

df <- read_csv(here("data_raw/sept21_feb22.csv"), na=c("\\0"))
glimpse(df)

```


```{r}
summary(df)

df_trimmed <- df %>% 
  mutate(
    night1 = as_factor(night),
  ) %>% 
  select(rotadate, night1, time_night) %>% 
  mutate(n1 = fct_anon(night1))


# Anonymise the people who did nights by giving username a number.

df_anon <- df_trimmed %>% 
  select(-night1)

View(df_anon)
View(df_trimmed)


# Group by consultant then count the total number of nights, the proportion filled in, and the average time of those completed

df_grp <-  df_trimmed %>% group_by(night1) %>% 
  summarise(night_count = n(),
            response_rate = sum(!is.na(time_night)) / n(),
            avg_time = mean(time_night, na.rm = TRUE)
            ) %>% 
  mutate(hrs = as.integer(avg_time) / (60*60)) %>% 
  arrange(desc(hrs))

View(df_grp)

```

Next to do
 - Visualise by hours recorded
 - Do something with return rate

